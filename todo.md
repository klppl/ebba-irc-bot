### TODO (clarified for future implementation)
- [x] 1) Non-blocking plugin dispatch (`core/plugin_manager.py`): on_message/on_join handlers currently run inline on the event loop. Wrap each handler call in `asyncio.create_task` (or require async handlers) and consider timeouts/exception guards so one slow/bad plugin cannot stall message handling or keepalive.
- [x] 2) Harden URL previews (`scripts/extract_url.py`): the fetcher reads full responses with no host/scheme vetting. Add streaming with a maximum byte budget, check `Content-Length`, and reject private/loopback IPs and non-HTTP(S) schemes to avoid SSRF and large-page DoS; keep retries/timeouts reasonable.
- [x] 3) Bound outbound send queue (`core/irc_client.py`): `_send_queue` is unbounded. Give it a `maxsize` and apply backpressure or a drop policy so plugin floods cannot grow memory indefinitely during slow sends/reconnects.
- [x] 4) Atomic, synchronized config writes (`core/irc_client.py`, `scripts/ignore.py`): current YAML rewrites are unsynchronized and non-atomic. Use a file lock plus write-to-temp-then-rename to prevent clobbering or truncated config when multiple updates happen close together.
- [ ] 5) Enforce TLS hostname verification (`core/irc_client.py`): when `use_tls=True`, pass `server_hostname=self.server` to `asyncio.open_connection` so certificates are hostname-checked and MITM is prevented.
- [ ] 6) Bound plugin task fan-out (`core/plugin_manager.py`): per-message handlers are spawned as unbounded tasks; add a semaphore/queue or drop policy to prevent memory/CPU blow-ups during floods.
- [ ] 7) Cross-platform config locking (`core/utils.py`): `file_lock` uses fcntl only; add a Windows-safe fallback (e.g., portalocker/fasteners or per-platform approach) so concurrent config writes stay serialized on all platforms.
- [ ] 8) Config schema validation (`bot.py`, `core/plugin_manager.py`): add a central config validator (e.g., pydantic/voluptuous or manual schema) run at startup and after hot reloads to fail fast with clear errors on bad config.
- [ ] 9) Graceful plugin task teardown (`core/plugin_manager.py`): track spawned handler tasks and cancel/await them on unload/reload/shutdown to avoid stray tasks running with stale state.
- [ ] 10) Metrics/visibility (`core/irc_client.py`, `core/plugin_manager.py`): add lightweight counters (messages processed, plugin failures/timeouts, reconnects, queue depth) surfaced via logs or optional Prometheus text endpoint for debugging.
- [ ] 11) Expose tuning knobs in config (`config_sample.yaml`, `core/irc_client.py`): surface `max_backoff`, join delay, rate-limiter settings so operators can tune without code changes.
- [ ] 12) Plugin test harness & CI (repo root): add fake bot + sample message tests and wire lint/format (ruff/black) in CI to catch regressions early.
- [ ] 13) HTTP plugin standards (`scripts/*`): standardize timeouts, user agents, and provide a mock/dry-run mode to avoid real API calls during CI.
- [x] 14) Command router and help (`core/plugin_manager.py`, plugins): add a registration-based command router with aliases/help text so plugins donâ€™t hand-roll parsing and a `.help` command can list usage.
- [ ] 15) Persistent plugin state helper (`core/utils.py` or new module): provide a small per-plugin state storage API (JSON/YAML, cached + atomic writes) so plugins reuse safe persistence instead of custom file handling.
- [ ] 16) Per-channel plugin toggles (`core/plugin_manager.py`, `config_sample.yaml`): allow enabling/disabling plugins per channel and persist the setting to reduce noise in specific rooms without unloading globally.
- [x] 17) Per-target rate limits (`core/irc_client.py`): add per-channel/user rate caps alongside the global limiter to prevent one room from being spammed while keeping other traffic flowing.
- [ ] 18) Admin audit trail (`core/irc_client.py`): log or send to a configured channel all admin actions (`.auth`, `.say`, `.join/.part`, plugin load/unload) for transparency and incident review.
- [x] 19) Health/status command (`core/irc_client.py`): expose a `.health`/`.status` command showing connected channels, last reconnect time, queue depth, and plugin load status for operators.
